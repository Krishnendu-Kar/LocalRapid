<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Product Details</title>
        <link rel="shortcut icon" href="LocaalRapid.ico" type="image/x-icon">
        <link rel="icon" href="LocaalRapid.ico" type="image/x-icon">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
        <link rel="stylesheet" href="product-detail.css">
        <script src="products.js"></script>
    </head>
    <body>
        <header>
            <div class="navbar">
                <div class="nav-logo border" onclick="window.location.href='index.html'">
                    <div class="logo-name">LocaalRapid</div>
                    <div class="logo" load="lazy"></div>
                </div>
                
                
                <div class="cart border" onclick="window.location.href='cart.html'">
                    <span class="cart-amount">0</span>
                    <div class="cart-icon">
                        <span><i class="fa-solid fa-cart-arrow-down"></i></span>
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <div class="product">
                    <div class="product-gallery">
                        <img id="main-image" src="" alt="Product Image">
                        <div class="thumbnail-container">
                            </div>
                    </div>
                    <div class="product-info" id="product-info">
                        </div>
                </div>
            </div>

            <div class="reviews">
                <a href="https://forms.gle/o6QnsSHPTd5EUZ2q6" target="_blank" class="feedback-btn">
                    Share Your Experience With Us
                </a>
            </div>
            <div class="recommended-container">
                <div class="recommended-title">Recommended for You</div>
                <div class="product-scroll">
                    </div>
            </div>
        </main>
        <footer>

        </footer>
        <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- 1. GET PRODUCT FROM URL (No changes here) ---
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get("id"));
            const product = products.find(p => p.id === productId);

            // --- 2. POPULATE PAGE WITH PRODUCT DATA (No changes here) ---
            if (product) {
                // ... (all the code to display the main product's info and images stays the same) ...
                document.title = `${product.name} - PickRapid`;

                const productInfoContainer = document.getElementById('product-info');
                const priceHTML = (product.price === product.originalPrice || !product.originalPrice)
                    ? `â‚¹${product.price}`
                    : `â‚¹${product.price} <del>â‚¹${product.originalPrice}</del>`;

                productInfoContainer.innerHTML = `
                    <h1>${product.name}</h1>
                    <p class="price">${priceHTML}</p>
                    ${product.delivery_time ? `<p class="delivery_time"><i class="fa-solid fa-clock"></i> ${product.delivery_time} </p>` : ''}
                    ${product.message ? `<p class="message"> ${product.message} </p>` : ''}
                    <p class="product-subcategory">${product.sub_category || 'no sub category'}</p>
                    <p class="product-message">${product.little_details || ''}</p>
                    <div class="product-details">
                        <h2 class="product-details-head">Product Full Details</h2>
                        <p class="product-details">Amount: ${product.amount || 'Amount has not publish'} <br> ${product.details || 'No more additional details are available.'}</p>
                    </div>
                    <button class="add-cart"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
                `;

                productInfoContainer.querySelector('.add-cart').addEventListener('click', () => {
                    addToCart(product);
                });

                document.getElementById('main-image').src = product.image;
                document.getElementById('main-image').alt = product.name;

                const thumbnailContainer = document.querySelector('.thumbnail-container');
                thumbnailContainer.innerHTML = `
                    <img class="thumbnail" src="${product.thumbnail1 || product.image}" alt="${product.name} thumbnail 1">
                    <img class="thumbnail" src="${product.thumbnail2 || product.image}" alt="${product.name} thumbnail 2">
                    <img class="thumbnail" src="${product.thumbnail3 || product.image}" alt="${product.name} thumbnail 3">
                `;

                document.querySelectorAll('.thumbnail').forEach(thumb => {
                    thumb.addEventListener('click', (e) => {
                        document.getElementById('main-image').src = e.target.src;
                    });
                });

                // --- 3. POPULATE RECOMMENDED PRODUCTS (This is where we change the call) ---
                displayRecommendedProducts(product); // ðŸ‘ˆ CHANGED: We now pass the whole product object
                
            } else {
                document.querySelector('.container').innerHTML = '<h1>Product not found!</h1><p><a href="index.html">Go back to shop</a></p>';
                document.querySelector('.recommended-container').style.display = 'none';
            }

            updateCartCount();
        });


        // ====== CART MANAGEMENT ======
        function getCart() {
            return JSON.parse(localStorage.getItem("cart")) || [];
        }

        function saveCart(cart) {
            localStorage.setItem("cart", JSON.stringify(cart));
        }

        function updateCartCount() {
            const cart = getCart();
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartAmountElement = document.querySelector(".cart-amount");
            if(cartAmountElement) {
                cartAmountElement.textContent = count;
            }
        }

        function addToCart(product) {
            let cart = getCart();
            const index = cart.findIndex(item => item.id === product.id);

            if (index !== -1) {
                cart[index].quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }

            saveCart(cart);
            updateCartCount();
            alert(`${product.name} added to cart!`);
        }

        // Update cart count on every page load
        document.addEventListener("DOMContentLoaded", updateCartCount);

        // --- RECOMMENDED PRODUCTS FUNCTION (This is where we change the logic) ---
        function displayRecommendedProducts(currentProduct) {
            const recommendedContainer = document.querySelector('.product-scroll');
            recommendedContainer.innerHTML = '';

            const recommendations = products
                .filter(p => p.category === currentProduct.category) 
                .filter(p => p.id !== currentProduct.id)
                .sort(() => 0.5 - Math.random())
                .slice(0, 5);

            if (recommendations.length === 0) {
                document.querySelector('.recommended-container').style.display = 'none';
                return;
            }

            recommendations.forEach(recProduct => {
                // --- CHANGE START ---
                // 1. Conditionally create the HTML for the original price
                let originalPriceDisplay = ''; // Default to an empty string

                // Check if originalPrice exists, is greater than 0, and is not the same as the sale price
                if (recProduct.originalPrice && recProduct.originalPrice > 0 && recProduct.originalPrice !== recProduct.price) {
                    originalPriceDisplay = `<span style="color:red; text-decoration:2px line-through; margin-left: 8px;">â‚¹${recProduct.originalPrice}</span>`;
                }
                
                // 2. Build the card's HTML, now using the conditional variable
                const cardHTML = `
                    <a href="product-details.html?id=${recProduct.id}" class="product-card">
                        <img src="${recProduct.image}" alt="${recProduct.name}">
                        <h4>${recProduct.name}</h4>
                        <div class="product-amount">${recProduct.amount || ''}</div>
                        <p>â‚¹${recProduct.price} ${originalPriceDisplay}</p> 
                        <button data-product-id="${recProduct.id}">Add to Cart</button>
                    </a>
                `;
                // --- CHANGE END ---

                recommendedContainer.innerHTML += cardHTML;
            });

            // Event listener logic remains the same
            recommendedContainer.querySelectorAll('.product-card button').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault(); 
                    event.stopPropagation();

                    const productId = parseInt(this.dataset.productId);
                    const productToAdd = products.find(p => p.id === productId);
                    if (productToAdd) {
                        addToCart(productToAdd);
                    }
                });
            });
        }
        </script>

    </body>
</html>